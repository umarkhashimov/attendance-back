{% extends 'layout/base.html' %}

{% block title %}
  <title>Все Группы</title>
{% endblock %}
{% block content %}
  {% include 'layout/navbar.html' %}

  <div class="container courses-list">
    <div class="mt-4 mb-2 d-flex align-items-center justify-content-between">
      <h5 class="m-0">Группы</h5>
      <a href="{% url 'courses:create_course' %}" class="btn btn-primary">Создать</a>
    </div>
    <hr class="table-group-divider" />
    <div class="row m-0 p-0 ">
      <div class="col-12 bg-light rounded pt-2 px-2 border">
        <form id="filterForm" method="get" action="{% url 'main:courses_list' %}" class="">
        <div class="">
          <h6 class="text-dark  ms-1 fs-6 m-0">Фильтры
          <button type="reset" class="filter-reset-btn ms-2 mb-1"><p>Очистить</p></button></h6>
        </div>
          <div class="row mt-2 pb-3">
            <div class="col-12 col-md-4">
              <div class="custom-select-2">
                <label for="daySelect" class="me-2 ms-1 mb-1">{{filter_form.weekdays.label}}</label>
                {{filter_form.weekdays}}
              </div>
            </div>
            <div class="col-12 col-sm-6 col-md-4">
              <div class="custom-select-2">
                <label for="teacherName" class="me-2 ms-1 mb-1">{{filter_form.teacher.label}}</label>
                {{filter_form.teacher}}
              </div>
            </div>
            <div class="col-12 col-sm-6 col-md-4">
              <div class="custom-select-2">
                <label for="subject" class="me-2 ms-1 mb-1">Курс</label>
                {{filter_form.subject}}
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>


        <div class="row px-2 mt-3">

          {% for obj in courses %}
          <div class="col-12 col-md-6 col-lg-4 px-1">
            <div class="position-relative px-0">
              <span class="position-absolute top-0 topic-label">{{obj.get_last_topic|default:"---"}}</span>
              <span class="position-absolute top-0 teacher-name-label">{{obj.teacher.first_name|default:"-"}} {{obj.teacher.last_name|default:"-"}}</span>
              <a href="{% url 'courses:course_update' pk=obj.id %}" class="border-2 border px-2 py-2 d-block course-list-item mt-2 mb-1">
                <div class="row">
                  <div class="col-9 gap-2 align-right pt-1">
                      <p class="text-dark mb-0 course-name mt-1 align-end h-100 w-100">
                        <span class="fs-6 text-secondary opacity-50 course-id">{{ obj.id }}</span>
                        {{ obj.subject|capfirst }} -
                        {{obj.get_name}}
                      </p>
                  </div>
                    <div class="col-3 d-flex align-items-end justify-content-end h-100 pt-1 p-0 pe-3">
                      <p class="badge text-bg-light border border-1 border-primary my-0 me-1">{{obj.get_enrolled_count}}</p>
                      <p class="m-0"><span class="badge text-bg-light border border-1" >{{ obj.lesson_time|time:'H:i' }}</span></p>
                    </div>
                </div>
              </a>
            </div>
          </div>
          {% empty %}
          <p class="text-center text-secondary">Нет груп.</p>
          {% endfor %}
          
          {% if page_obj.paginator.count > 30 %}
        <div class="row mt-5">
          <div class="col-12 col-lg-8 offset-lg-2 d-flex justify-content-center">
            <nav aria-label="Page navigation example">
              <ul class="pagination ">
                {% if page_obj.has_previous %}
                <li class="page-item">
                  <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}"
                  aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              {% endif %}
              {% for page in paginator.page_range %}
              {% if page_obj.number == page %}
              <li class="page-item ms-1"><a class="page-link active"
                href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page }}">{{ page }}</a></li>
                {% elif page > page_obj.number|add:-4 and page < page_obj.number|add:4 %}
                <li class="page-item ms-1"><a class="page-link"
                  href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page }}">{{ page }}</a></li>
                  {% endif %}
                  {% endfor %}
                  {% if page_obj.has_next %}
                  <li class="page-item ms-1">
                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}"
                    aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
                {% endif %}
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
        {% endif %}
        
      </div>
      
      <script>
        let filterForm = document.querySelector('form#filterForm')
        filterForm.addEventListener('reset', (event) => {
          event.preventDefault();
      event.target.reset()
      event.target.querySelectorAll('input').forEach((inp)=>{inp.removeAttribute('value')})
      event.target.querySelectorAll('option').forEach((select)=>{select.removeAttribute('selected')})
      event.target.submit()
    })

  </script>
  
{% endblock %}
  
{% block custom_js %}
  <script>
    $(document).ready(function () {
      $("#id_soft_skills").select2({
        placeholder: 'Дни'
      })
    });
    $(document).ready(function () {
      $('select').select2() // Apply select2 to all select elements
    })
  </script>
{% endblock  %}