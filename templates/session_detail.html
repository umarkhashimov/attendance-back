{% extends 'layout/base.html' %}

{% block title %}
  <title>Курс</title>
{% endblock %}
{% block content %}
  {% include 'layout/navbar.html' %}

  <div class="container courses-list mt-5 pb-5">
    <h1>{{ session.course.course_name }}</h1><h2 class="mt-3"> Урок {{ session.session_number }} - {{ session.date }}</h2>
    <hr class="table-group-divider"  />

    <form method="post" action="{% url 'main:session_detail' session_id=session.id %}">
      {% csrf_token %}
      {% for obj in enrollments %}
        {{ obj.enrollment }}
        <div class="border-2 border p-3 d-block course-list-item my-3">
          <div class="row">
            <div class="col-12 col-md-6 mb-3 mb-sm-4 mb-md-0 d-flex align-items-center">
               {% if obj.student.id  in exist  %}
               {% for record in attendance %}
                  {% if record.enrollment.student.id == obj.student.id %}
                  
                  <select name="stid_{{ obj.student.student_id }}" id="">
                    <option value="">---</option>
                  {% for choice in status_choices  %}
                  <option value="{{choice.0}}" {% if record.status == choice.0 %}selected{% endif %}>{{choice.1}}</option>
                  {% endfor %}
                </select>
                {% endif %}
                
                {% endfor %}
                {% else %}
                <select name="stid_{{ obj.student.student_id }}" id="">
                  <option value="">----</option>
                {% for choice in status_choices  %}
                <option value="{{choice.0}}" {% if record.status == choice.0 %}selected{% endif %}>{{choice.1}}</option>
                {% endfor %}
              </select>
              {% endif %} 
              <p class="m-0 ms-3">{{obj.student.first_name}} {{obj.student.last_name}}</p>
            </div>
            <div class="col-12 col-sm-2 col-md-1 d-flex align-items-center">
              <p class="text-dark m-0">--:--</p>
            </div>
            <div class="col-12 col-sm-10 col-md-5 d-flex align-items-center">
              <p class="main-lesson-days m-0 text-dark">{{ obj.student.student_id }}</p>
            </div>
          </div>
        </div>
      {% endfor %}
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary py-3">Сохранить</button>
      </div>
    </form>
    {% comment %} <form method="post">
      {% csrf_token %}
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Attendance Status</th>
          </tr>
        </thead>
        <tbody>
          {% for form, student in attendance_data %}
            <tr>
              <td>{{ student.student.first_name }}</td> <!-- Display student's name -->
              <td>{{ form.status }}</td> <!-- Dropdown for attendance status -->
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit">Save Attendance</button>
    </form> {% endcomment %}

    {% comment %} <form action="">
      {{exist.enrollment.values_list}}
      {% for obj in enrollments %}
        {{ obj.enrollment }}
        <div class="border-2 border p-3 d-block course-list-item my-3">
          <div class="row">
            <div class="col-12 col-md-6 mb-3 mb-sm-4 mb-md-0 d-flex align-items-center">
              {% if (obj.student.id, session.id) in exist  %}
              yesss
              {% else %}
              nooo
              {{exist.student|make_list}}
              {% endif %}

              <select name="stid_{{ obj.student.student_id }}" id="">
                <option value="1">Present</option>
                <option value="0">Absent</option>
                <option value="3">Late</option>
              </select>
              <p class="text-dark m-0 ms-3">{{ obj.student.first_name }} {{ obj.student.last_name }}</p>
            </div>
            <div class="col-12 col-sm-2 col-md-1 d-flex align-items-center">
              <p class="text-dark m-0">--:--</p>
            </div>
            <div class="col-12 col-sm-10 col-md-5 d-flex align-items-center">
              <p class="main-lesson-days m-0 text-dark">{{ obj.student.student_id }}</p>
            </div>
          </div>
        </div>
      {% endfor %}
    </form> {% endcomment %}
  </div>
{% endblock %}
