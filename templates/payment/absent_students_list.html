{% extends 'layout/base.html' %}

{% block title %}
    <title>Панель Управления</title>
{% endblock %}
{% block content %}
    {% include 'layout/navbar.html' %}

    <div class="container courses-list">
        <div class="mt-5 mb-2 d-flex align-items-center justify-content-between">
        </div>
        {% include './payments_page_navbar.html' %}
        <hr class="table-group-divider mt-0"/>

        <div class="d-flex flex-column flex-md-row mb-3">
            <div class="bg-light bg-light rounded py-2 px-2 border">
                <form method="get">
                    <div class="mb-3">
                        <h6 class="text-dark ms-1 fs-6 m-0">Просмотр по дате
                            <a href="?date={{ today }}" type="reset" class="filter-reset-btn ms-2 mb-1"><p>
                                Сбросить</p></a>
                        </h6>
                    </div>
                    <div class="d-flex gap-2">

                        <a href="?date={{ prev_date|date:"Y-m-d" }}" class="btn btn-outline-primary"><i
                                class="bi bi-caret-left-fill"></i></a>
                        <input type="date" name="date" max="{{ today }}" value="{{ filter_date }}"
                               class="form-control border-primary" onchange="this.form.submit()">
                        <a href="?date={{ next_date|date:"Y-m-d" }}"
                           class="btn btn-outline-primary {% if filter_date == today %} disabled{% endif %}"><i
                                class="bi bi-caret-right-fill"></i></a>
                    </div>
                </form>
            </div>
        </div>
        <div class="row px-3 mt-3 debt-accordions">

            {% for teacher, courses in teacher_enrollments.items %}
                <ol class="list-group my-2 border-primary border p-0">
                    <li class="list-group-item list-group-item-primary w-100 fs-5 fw-semibold mb-3">{{ forloop.counter }}. {{ teacher }}</li>
                    {% for course, enrollments in courses.items %}
                        <li class="list-unstyled list-group-item border-0 py-0 mb-3">

                            <ul class="list-group border border-secondary shadow shadow-sm"
                                id="courseTable{{ course.id }}">
                                <li class="list-group-item-secondary list-group-item fw-semibold bg-opacity-25">
                                    <a href="{% url 'courses:course_update' pk=course.course.id %}"
                                       class="my-auto text-dark table-obj-name-link text-decoration-none">{{ course }}</a>
                                </li>
                                {% for attendance in enrollments %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center list-items-hover">
                                        <div class="d-flex">
                                            <span class="text-secondary me-1">{{ forloop.counter }}.</span> <a
                                                href="{% url 'students:student_update' pk=attendance.enrollment.student.id %}"
                                                class="my-auto text-dark table-obj-name-link text-decoration-none">{{ attendance.enrollment.student.full_name }}</a>
                                            <p class="m-0 ms-2  {% if attendance.status == 0 %}text-danger {% else %}text-secondary {% endif %}">
                                                - {{ attendance.get_status_display|default:"?" }}</p>
                                        </div>
                                        <div class="debt-students-phone-numbers d-flex align-items-center gap-3">
                                            <span type="button" copy="{{ attendance.enrollment.student.phone_number }}"
                                                  onclick="navigator.clipboard.writeText(this.getAttribute('copy')), this.classList.add('copied'), setTimeout(()=>{this.classList.remove('copied')}, 1000)">{{ attendance.enrollment.student.phone_number }}</span>
                                            <span type="button"
                                                  copy="{{ attendance.enrollment.student.additional_number|default_if_none:"---" }}"
                                                  {% if enrollment.student.additional_number %}onclick="navigator.clipboard.writeText(this.getAttribute('copy')), this.classList.add('copied'), setTimeout(()=>{this.classList.remove('copied')}, 1000)"{% endif %}>{{ attendance.enrollment.student.additional_number|default_if_none:"---" }}</span>
                                            <div class="w-350px">
                                                <form method="post" onsubmit="handleFormSubmit(event)" class="w-350px noBtn note-update-form"
                                                  action="{% url 'students:update_enrollment_note' pk=attendance.enrollment.id %}">
                                                {% csrf_token %}
                                                <input name="text" onchange="this.form.requestSubmit()" maxlength="40"
                                                       class="text-center form-control rounded-0 align-middle w-100"
                                                       value="{{ attendance.enrollment.note|default:'' }}">
                                            </form>
                                            </div>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ol>
            {% empty %}
                <p class="text-center text-secondary">Пусто.</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}
